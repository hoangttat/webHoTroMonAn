@using WebOrderTbRestaurant.Models
@{
    ViewBag.Title = "Thống kê & báo cáo";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    var product_sell = ViewBag.product_sell as List<BookFood>;
    var sp_sell_month = ViewBag.sp_sell_month as List<BookFood>;
    var sp_sell_nsx = ViewBag.sp_sell_nsx as List<BookFood>;
    int dem_2 = 0, dem_3 = 0, dem_4 = 0;
}


<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Thống kê & báo cáo</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-money fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div style="font-size: 30px">@string.Format("{0:0,0}", @TempData["TongDoanhThu"])</div>
                        <div></div>
                    </div>
                </div>
            </div>
            <a href="#">
                <div class="panel-footer">
                    <span class="pull-left">Tổng doanh thu</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-green">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-credit-card fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div style="font-size: 30px">@string.Format("{0:0,0}", @TempData["DoanhThuHomNay"])</div>
                        <div></div>
                    </div>
                </div>
            </div>
            <a href="#">
                <div class="panel-footer">
                    <span class="pull-left">Doanh thu hôm nay</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-yellow">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-shopping-cart fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">@TempData["DonDatMoi"]</div>
                        <div></div>
                    </div>
                </div>
            </div>
            <a href="#">
                <div class="panel-footer">
                    <span class="pull-left">Đơn hàng mới</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="panel panel-red">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-folder fa-5x"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge">@TempData["MonAn"]</div>
                        <div></div>
                    </div>
                </div>
            </div>
            <a href="#">
                <div class="panel-footer">
                    <span class="pull-left">Đơn hàng mới</span>
                    <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                    <div class="clearfix"></div>
                </div>
            </a>
        </div>
    </div>
</div>
<!-- /.row -->
<div class="row">
    <div class="col-lg-8">
        <div class="panel panel-primary">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Biểu đồ lượt đặt bàn hàng tháng
            </div>
            <div class="panel-body">
                <div id="SaleChart_Month"></div>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Biểu đồ doanh thu đặt món theo danh mục
            </div>
            <div class="panel-body">
                <div id="SaleChart_Brand"></div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bar-chart-o fa-fw"></i> Món ăn bán chạy
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th class="text-center">Tên món ăn</th>
                                <th class="text-center">Số lượng</th>
                                <th class="text-center">Tổng tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in product_sell)
                            {
                                dem_2++;
                                <tr>
                                    <td class="text-center">@dem_2</td>
                                    <td class="text-center">@item.Food_Name</td>
                                    <td class="text-center">@item.Count</td>
                                    <td class="text-center">@item.TotalMoney.Value.ToString("N0")</td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
            </div>
            <!-- /.panel-body -->
        </div>
        
    </div>
    <!-- /.col-lg-8 -->
    <div class="col-lg-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <i class="fa fa-bell fa-fw"></i> Báo cáo hằng ngày
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="list-group">
                    <a href="#" class="list-group-item">
                        <i class="fa fa-paper-plane fa-fw"></i> Số bài viết
                        <span class="pull-right text-muted small">
                            <em>@ViewBag.BaiViet bài viết</em>
                        </span>
                    </a>
                    
                    <a href="#" class="list-group-item">
                        <i class="fa fa-list fa-fw"></i> Đơn đặt hôm nay
                        <span class="pull-right text-muted small">
                            <em>@ViewBag.Order_today đơn</em>
                        </span>
                    </a>
                    <a href="#" class="list-group-item">
                        <i class="fa fa-user fa-fw"></i> User đã đăng ký
                        <span class="pull-right text-muted small">
                            <em>@ViewBag.user user</em>
                        </span>
                    </a>
                    <a href="#" class="list-group-item">
                        <i class="fa fa-table fa-fw"></i> Đơn hàng đã thanh toán
                        <span class="pull-right text-muted small">
                            <em>@ViewBag.OrderPait đơn</em>
                        </span>
                    </a>
                    <a href="#" class="list-group-item">
                        <i class="fa fa-check fa-fw"></i> Tổng đơn hàng
                        <span class="pull-right text-muted small">
                            <em>@ViewBag.TongDH đơn</em>
                        </span>
                    </a>
                </div>
               
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel -->
        <div class="panel panel-danger">
            <div class="panel-heading">
                <i class="fa fa-table fa-fw"></i> Món đặt nhiều trong tháng @ViewBag.Month
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th class="text-center">Sản phẩm</th>
                                <th class="text-center">Số lượng</th>
                                <th class="text-center">Tổng tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in sp_sell_month)
                            {
                                dem_3++;
                                <tr>
                                    <td class="text-center">@dem_3</td>
                                    <td class="text-center">@item.Food_Name</td>
                                    <td class="text-center">@item.Count</td>
                                    <td class="text-center">@item.TotalMoney.Value.ToString("N0")</td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
                <!-- /.table-responsive -->
            </div>
            <!-- /.panel-body -->
        </div>

        <div class="panel panel-danger">
            <div class="panel-heading">
                <i class="fa fa-table fa-fw"></i> Món ăn đã đặt theo danh mục
            </div>
            <!-- /.panel-heading -->
            <div class="panel-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th class="text-center">Danh mục</th>
                                <th class="text-center">Số lượng</th>
                                <th class="text-center">Doanh thu</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in sp_sell_nsx)
                            {
                                dem_4++;
                                <tr>
                                    <td class="text-center">@dem_4</td>
                                    <td class="text-center">@item.Food_Category_Name</td>
                                    <td class="text-center">@item.Count</td>
                                    <td class="text-center">@item.TotalMoney.Value.ToString("N0")</td>
                                </tr>
                            }

                        </tbody>
                    </table>
                </div>
                <!-- /.table-responsive -->
            </div>
            <!-- /.panel-body -->
        </div>
        <!-- /.panel .chat-panel -->
    </div>
    <!-- /.col-lg-4 -->
</div>
<!-- /.row -->


@section jsFooter{

    <script>


        $(document).ready(function () {

            //Biểu đồ doanh thu bán hàng hàng tháng
            $.ajax({
                type: 'GET',
                url: '/Admin/Home/TotalSale_Month',
                data: {},
                contentType: "application/json;charset=utf-8",
                dataType: 'json',
                success: function (res) {
                    Month_GenarateChart(res);
                    console.log(res);
                },
                error: function (errormessage) {
                    alert("error");
                    console.log(errormessage.responseText);
                }
            });

            //Biểu đồ doanh thu bán hàng theo thương hiệu
            $.ajax({
                type: 'GET',
                url: '/Admin/Home/TotalSale_Brand',
                data: {},
                contentType: "application/json;charset=utf-8",
                dataType: 'json',
                success: function (res) {
                    Brand_GenarateChart(res);
                    console.log(res);
                },
                error: function (errormessage) {
                    alert("error");
                    console.log(errormessage.responseText);
                }
            });


        });

        function formatNumber(num) {
            return num.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1.")
        }

        function Month_GenarateChart(jsondata) {

            var month = ['x'];
            var Total = ['total'];

            jsondata.forEach(function (e) {
                //e.total = formatNumber(e.total);
                Total.push(e.tong);
                month.push("Tháng " + e.thang);
            })
            console.log(month);
            console.log(Total);

            var chart = c3.generate({
                bindto: '#SaleChart_Month',
                data: {
                    x: 'x',
                    columns: [
                        month,
                        Total
                    ],
                    type: 'bar',
                },
                axis: {
                    x: {
                        type: 'category', // this needed to load string x value
                        label: {
                            position: 'outer-center'
                        }

                    },
                    y: {
                        tick: {
                            format: d3.format(",")
                        }
                    }
                },
                color: {
                    Total: '#ff0000'
                },
                labels: true
            });

            chart.data.names(
                {
                    total: 'Biểu đồ doanh thu hàng tháng (VNĐ)'
                });
        }

        function Brand_GenarateChart(jsondata) {

            var Brand = ['x'];
            var Total = ['total'];

            jsondata.forEach(function (e) {
                Total.push(e.tong);
                Brand.push(e.Food_Category_Name);
            })
            console.log(Brand);
            console.log(Total);

            var chart = c3.generate({
                bindto: '#SaleChart_Brand',
                data: {
                    x: 'x',
                    columns: [
                        Brand,
                        Total
                    ],
                    type: 'bar',
                },
                axis: {
                    x: {
                        type: 'category', // this needed to load string x value
                        label: {
                            position: 'outer-center'
                        }
                    },
                    y: {
                        tick: {
                            format: d3.format(",")
                        }
                    }
                },
                color: {
                    Total: '#ff0000'
                },
                labels: true
            });

            chart.data.names(
                {
                    total: 'Biểu đồ doanh thu theo danh mục món ăn (VNĐ)'
                });
        }
    </script>

}

